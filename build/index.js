(()=>{"use strict";var e,t={660:(e,t,o)=>{var r={};o.r(r),o.d(r,{isAuthenticated:()=>_});var a={};o.r(a),o.d(a,{updateAuthenticationStatus:()=>E});const i=window.wp.blocks,l=window.React,n=function(){return(0,l.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 771.444"},(0,l.createElement)("rect",{x:"427.842",width:"166.721",height:"172.249",fill:"#4FC3F7"}),(0,l.createElement)("rect",{x:"338.962",y:"172.249",width:"255.601",height:"166.721",fill:"#5586FF"}),(0,l.createElement)("rect",{x:"172.241",y:"172.249",width:"166.721",height:"255.609",fill:"#3D5AFE"}),(0,l.createElement)("rect",{y:"427.858",width:"338.962",height:"166.721",fill:"#3949AB"}),(0,l.createElement)("rect",{x:"851.743",y:"176.865",width:"172.257",height:"166.721",fill:"#FFAB00"}),(0,l.createElement)("rect",{x:"685.022",y:"176.865",width:"166.721",height:"255.609",fill:"#FF5252"}),(0,l.createElement)("rect",{x:"596.142",y:"432.474",width:"255.601",height:"166.721",fill:"#F50057"}),(0,l.createElement)("rect",{x:"429.421",y:"432.483",width:"166.721",height:"338.961",fill:"#C51162"}))},s=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"woosmap/store-locator-widget-block","version":"0.1.0","title":"Woosmap Store Locator Widget Block","category":"widgets","keywords":["Woosmap","Store Locator","Store Finder","Map"],"description":"Easily display your stores on a Map using Woosmap platform","example":{},"supports":{"align":["wide","full"],"spacing":{"margin":true},"html":false,"multiple":false},"attributes":{"height":{"type":"string","default":"500"},"apiKey":{"type":"string"},"theme":{"type":"object","properties":{"primary_color":{"type":"string","default":"#000"}},"default":{"primary_color":"#000"}},"internationalization":{"type":"object","properties":{"lang":{"type":"string","default":"en"},"period":{"type":"string","default":"fr"},"unitSystem":{"type":"number","default":0}},"default":{"lang":"en","period":"fr","unitSystem":0}},"woosmapView":{"type":"object","default":{"breakPoint":10,"tileStyle":{"color":"#000","size":11,"minSize":5},"initialCenter":{"lat":50,"lng":0},"initialZoom":6,"style":{"default":{"icon":{"url":"https://images.woosmap.com/marker-default.svg"},"selectedIcon":{"url":"https://images.woosmap.com/marker-selected.svg"},"numberedIcon":{"url":"https://images.woosmap.com/marker-default.svg"}}}}},"filters":{"type":"object","default":{}},"customMarkers":{"type":"array","default":[],"items":{"type":"object","properties":{"storeType":{"type":"string"},"customTyleColor":{"type":"string"},"customDefaultMarkerUrl":{"type":"string"},"customSelectedMarkerUrl":{"type":"string"},"customNumberedMarkerUrl":{"type":"string"}}}}},"textdomain":"store-locator-widget-block","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css","viewScript":"file:./view.js","script":"woosmap-webapp-js"}'),c=window.wp.components,m=window.wp.i18n,u=window.wp.blockEditor,d=window.wp.element,p=window.wp.data,g=window.wp.compose,h={theme:{primary_color:"#000"},datasource:{max_responses:5,max_distance:5e4},internationalization:{lang:"en",period:"fr",unitSystem:0},maps:{apiKey:"",provider:"woosmap"},woosmapView:{initialCenter:{lat:50,lng:0},initialZoom:13,tileStyle:{color:"#000",size:11,minSize:5,typeRules:[]},breakPoint:10,style:{rules:[],default:{icon:{url:"https://images.woosmap.com/marker-default.svg"},selectedIcon:{url:"https://images.woosmap.com/marker-selected.svg"},numberedIcon:{url:"https://images.woosmap.com/marker-default.svg"}}}}};function b(e,t){return Object.keys(t).forEach((o=>{Array.isArray(t[o])?e[o]=t[o]:t[o]&&"object"==typeof t[o]?(e[o]||(e[o]={}),b(e[o],t[o])):e[o]=t[o]})),e}function w(e,t={}){try{return b(t,JSON.parse(e))}catch(e){return(0,p.dispatch)("core/notices").createErrorNotice(`Error parsing conf: ${e.message}`,{isDismissible:!0,type:"snackbar"}),t}}class y{constructor(e){this.element=e,this.storeLocatorConfig={},this.webAppLib=e.ownerDocument.defaultView.WebApp,this.webAppLib&&this.element.dataset.apiKey&&this.init()}init(){this.createStoreLocatorWidget()}createStoreLocatorWidget(){const e=function(e){const{filters:t="{}",theme:o="{}",datasource:r="{}",internationalization:a="{}",woosmapView:i="{}",apiKey:l}=e,n=w(i,h.woosmapview);return{theme:w(o,h.theme),datasource:w(r,h.datasource),internationalization:w(a,h.internationalization),maps:{apiKey:l,provider:"woosmap"},woosmapview:{...n,initialCenter:n.initialCenter,initialZoom:n.initialZoom,tileStyle:{color:n.tileStyle.color,size:Number(n.tileStyle.size),minSize:Number(n.tileStyle.minSize),typeRules:n.tileStyle.typeRules},breakPoint:Number(n.breakPoint),style:{rules:n.style.rules,default:n.style.default}},filters:w(t,{})}}(this.element.dataset);this.storeLocatorConfig=function(e){if(!e.maps.apiKey||"string"!=typeof e.maps.apiKey||!e.maps.apiKey.trim())throw new Error("StoreLocator configuration error: apiKey is required and must be a non-empty string.");return e}(e),this.element.innerHTML="";const t=document.createElement("div");t.style="width:100%; height:100%",t.id="store-locator-widget-id",this.element.appendChild(t),this.storeLocatorWidget=new this.webAppLib(t.id,this.storeLocatorConfig.maps.apiKey),this.storeLocatorWidget.isMobile=!1,this.storeLocatorWidget.setConf(this.storeLocatorConfig),this.storeLocatorWidget.render()}}class f extends y{constructor(e,t,o){super(e),this.clientId=t,this.setAttributes=o,this.initEdit()}initEdit(){this.addListeners()}refreshScript(e){const t="https://webapp.woosmap.com/webapp.js";if(this.element.ownerDocument.querySelector(`script[src="${t}"][data-loading]`))return;const o=this.element.ownerDocument.querySelector(`script[src="${t}"]`);o&&(["WebApp","woosmap"].forEach((e=>{void 0!==this.element.ownerDocument.defaultView[e]&&(this.element.ownerDocument.defaultView[e]=null)})),o.parentNode.removeChild(o));const r=this.element.ownerDocument.createElement("script");r.src=t,r.setAttribute("data-loading","true"),r.onload=()=>{r.removeAttribute("data-loading"),this.webAppLib=this.element.ownerDocument.defaultView.WebApp,e()},r.onerror=e=>{(0,p.dispatch)("core/notices").createErrorNotice(`Failed to load the script:${e}`,{isDismissible:!0,type:"snackbar"}),r.removeAttribute("data-loading")},this.element.ownerDocument.head.appendChild(r)}remove(){this.storeLocatorWidget&&(this.element.parentNode.removeChild(this.element),this.storeLocatorWidget=null)}addListeners(){this.element.addEventListener("click",(()=>{(0,p.dispatch)("core/block-editor").selectBlock(this.clientId)}))}updateDatasetProperty(e,t){this.element.dataset[e]="object"==typeof t?JSON.stringify(t):t}update(e,t=!0){Object.entries(e).forEach((([e,t])=>{"height"===e?this.element.style.height=`${t}px`:this.updateDatasetProperty(e,t)})),t&&this.refreshScript((()=>this.init()))}}const k=(0,p.combineReducers)({authenticationReducer:function(e,t){return"UPDATE_AUTHENTICATION"===t.type?{...e,authenticated:t.isAuthenticated}:e}});function _(e){return Boolean(e?.authenticationReducer?.authenticated)}function E(e){return{type:"UPDATE_AUTHENTICATION",isAuthenticated:e}}const v=(0,p.createReduxStore)("woosmap/store-locator-widget-block",{reducer:k,selectors:r,actions:a});function C(e){const{attributes:{height:t,theme:o,woosmapView:r},setAttributes:a}=e;return(0,l.createElement)(c.PanelBody,{title:(0,m.__)("Display Settings","store-locator-widget-block")},(0,l.createElement)(c.PanelRow,null,(0,l.createElement)("label",{htmlFor:"theme-color-control"},(0,m.__)("Primary Color","store-locator-widget-block")),(0,l.createElement)(c.ColorIndicator,{id:"theme-color-control",colorValue:o.primary_color})),(0,l.createElement)(c.ColorPalette,{value:o.primary_color,onChange:e=>a({theme:{primary_color:e}})}),(0,l.createElement)(c.RangeControl,{label:(0,m.__)("Zoom","store-locator-widget-block"),value:r.initialZoom,onChange:e=>a({woosmapView:{...r,initialZoom:e}}),min:0,max:20,step:.5}),(0,l.createElement)(c.RangeControl,{label:(0,m.__)("Height ( pixels )","store-locator-widget-block"),value:Number(t),onChange:e=>a({height:e}),min:250,max:3e3,step:5}),(0,l.createElement)(c.RangeControl,{label:(0,m.__)("Default Latitude","store-locator-widget-block"),value:r.initialCenter.lat,onChange:e=>a({woosmapView:{...r,initialCenter:{...r.initialCenter,lat:e}}}),min:-90,max:90,step:.1}),(0,l.createElement)(c.RangeControl,{label:(0,m.__)("Default Longitude","store-locator-widget-block"),value:r.initialCenter.lng,onChange:e=>a({woosmapView:{...r,initialCenter:{...r.initialCenter,lng:e}}}),min:-180,max:180,step:.1}))}function S(e){const{attributes:{woosmapView:t},setAttributes:o}=e,{breakPoint:r,tileStyle:a,style:i}=t||{};return(0,l.createElement)(c.PanelBody,{title:(0,m.__)("Marker Settings","store-locator-widget-block"),initialOpen:!1},(0,l.createElement)(c.PanelRow,null,(0,l.createElement)("label",{htmlFor:"tile-color-control"},(0,m.__)("Tile Color","store-locator-widget-block")),(0,l.createElement)(c.ColorIndicator,{id:"tile-color-control",colorValue:a.color})),(0,l.createElement)(c.ColorPalette,{value:a.color,onChange:e=>o({woosmapView:{...t,tileStyle:{...a,color:e}}})}),(0,l.createElement)(c.RangeControl,{label:(0,m.__)("Tile Size","store-locator-widget-block"),value:a.size,onChange:e=>o({woosmapView:{...t,tileStyle:{...a,size:e}}}),min:1,max:50,step:1}),(0,l.createElement)(c.RangeControl,{label:(0,m.__)("Break Point","store-locator-widget-block"),value:r,onChange:e=>o({woosmapView:{...t,breakPoint:e}}),min:1,max:20,step:1}),(0,l.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,l.createElement)(c.TextControl,{label:(0,m.__)("Default Marker Url","store-locator-widget-block"),value:i.default.icon.url,onChange:e=>o({woosmapView:{...t,style:{...i,default:{...i.default,icon:{url:e}}}}})}),i.default.icon.url&&(0,l.createElement)("img",{src:i.default.icon.url,alt:"Default Marker Url",style:{maxWidth:"100%",height:"auto"}})),(0,l.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,l.createElement)(c.TextControl,{label:(0,m.__)("Selected Marker Url","store-locator-widget-block"),value:i.default.selectedIcon.url,onChange:e=>o({woosmapView:{...t,style:{...i,default:{...i.default,selectedIcon:{url:e}}}}})}),i.default.selectedIcon.url&&(0,l.createElement)("img",{src:i.default.selectedIcon.url,alt:"Selected Marker Url",style:{maxWidth:"100%",height:"auto"}})),(0,l.createElement)("div",{style:{padding:10,border:"1px solid lightgray",borderRadius:5}},(0,l.createElement)(c.TextControl,{label:(0,m.__)("Numbered Marker Url","store-locator-widget-block"),value:i.default.numberedIcon.url,onChange:e=>o({woosmapView:{...t,style:{...i,default:{...i.default,numberedIcon:{url:e}}}}})}),i.default.numberedIcon.url&&(0,l.createElement)("img",{src:i.default.numberedIcon.url,alt:"Numbered Marker Url",style:{maxWidth:"100%",height:"auto"}})))}function x(e){const{index:t,marker:o,storeType:r,customTyleColor:a,customDefaultMarkerUrl:i,customSelectedMarkerUrl:n,customNumberedMarkerUrl:s,customMarkers:u,setAttributes:d}=e,g=e=>{const o=u.map(((o,r)=>r===t?e:o));d({customMarkers:o})};return(0,l.createElement)(c.PanelBody,{title:(0,m.__)("Edit: ","store-locator-widget-block")+r,initialOpen:!1},(0,l.createElement)(c.TextControl,{label:(0,m.__)("Store Type","store-locator-widget-block"),value:r,onChange:e=>{(e=>!!e.trim()||((0,p.dispatch)("core/notices").createErrorNotice((0,m.__)("Store Type cannot be empty","store-locator-widget-block"),{isDismissible:!0,type:"snackbar"}),!1))(e)&&g({...o,storeType:e})}}),(0,l.createElement)(c.PanelRow,null,(0,l.createElement)("label",{htmlFor:"custom-tile-color-control"},(0,m.__)("Custom Tile Color","store-locator-widget-block")),(0,l.createElement)(c.ColorIndicator,{id:"custom-tile-color-control",colorValue:a})),(0,l.createElement)(c.ColorPalette,{value:a,onChange:e=>g({...o,customTyleColor:e})}),(0,l.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,l.createElement)(c.TextControl,{label:(0,m.__)("Custom Default Marker Url","store-locator-widget-block"),value:i,onChange:e=>g({...o,customDefaultMarkerUrl:e})}),i&&(0,l.createElement)("img",{src:i,alt:"Custom Default Marker",style:{maxWidth:"100%",height:"auto"}})),(0,l.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,l.createElement)(c.TextControl,{label:(0,m.__)("Custom Selected Marker Url","store-locator-widget-block"),value:n,onChange:e=>g({...o,customSelectedMarkerUrl:e})}),n&&(0,l.createElement)("img",{src:n,alt:"Custom Selected Marker",style:{maxWidth:"100%",height:"auto"}})),(0,l.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,l.createElement)(c.TextControl,{label:(0,m.__)("Custom Numbered Marker Url","store-locator-widget-block"),value:s,onChange:e=>g({...o,customNumberedMarkerUrl:e})}),s&&(0,l.createElement)("img",{src:s,alt:"Custom Numbered Marker",style:{maxWidth:"100%",height:"auto"}})),(0,l.createElement)(c.Button,{variant:"primary",onClick:()=>{const e=u.filter(((e,o)=>o!==t));d({customMarkers:e})}},(0,m.__)("Delete Custom Marker","store-locator-widget-block")))}function A(e){const{attributes:{customMarkers:t},setAttributes:o}=e,[r,a]=(0,d.useState)("");return(0,l.createElement)(c.PanelBody,{title:(0,m.__)("Custom Marker Settings","store-locator-widget-block"),initialOpen:!1},(0,l.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,l.createElement)(c.TextControl,{label:(0,m.__)("Store Type","store-locator-widget-block"),value:r,onChange:e=>a(e)}),(0,l.createElement)(c.Button,{variant:"primary",onClick:()=>{if(!r.trim())return void(0,p.dispatch)("core/notices").createErrorNotice((0,m.__)("Store Type Title cannot be empty","store-locator-widget-block"),{isDismissible:!0,type:"snackbar"});const e={storeType:r,customTyleColor:"#000",customDefaultMarkerUrl:"https://images.woosmap.com/marker-default.svg",customSelectedMarkerUrl:"https://images.woosmap.com/marker-selected.svg",customNumberedMarkerUrl:"https://images.woosmap.com/marker-default.svg"},i=[...t,e];o({customMarkers:i}),a("")}},(0,m.__)("Add Custom Marker","store-locator-widget-block"))),t.map(((e,r)=>(0,l.createElement)(x,{key:r,index:r,marker:e,storeType:e.storeType,customTyleColor:e.customTyleColor,customDefaultMarkerUrl:e.customDefaultMarkerUrl,customSelectedMarkerUrl:e.customSelectedMarkerUrl,customNumberedMarkerUrl:e.customNumberedMarkerUrl,customMarkers:t,setAttributes:o}))))}function P(e){const{attributes:{internationalization:t},setAttributes:o}=e;return(0,l.createElement)(c.PanelBody,{title:(0,m.__)("Internationalization Settings","store-locator-widget-block"),initialOpen:!1},(0,l.createElement)(c.SelectControl,{label:(0,m.__)("Language","store-locator-widget-block"),value:t.lang,onChange:e=>o({internationalization:{...t,lang:e,period:t.period,unitSystem:t.unitSystem}})},(0,l.createElement)("option",{value:"pt-br"},(0,m.__)("Brazilian Portuguese","store-locator-widget-block")),(0,l.createElement)("option",{value:"ca"},(0,m.__)("Catalan","store-locator-widget-block")),(0,l.createElement)("option",{value:"zh"},(0,m.__)("Chinese","store-locator-widget-block")),(0,l.createElement)("option",{value:"zh-HK"},(0,m.__)("Chinese (Hong Kong)","store-locator-widget-block")),(0,l.createElement)("option",{value:"hr"},(0,m.__)("Croatian","store-locator-widget-block")),(0,l.createElement)("option",{value:"de"},(0,m.__)("Deutsch","store-locator-widget-block")),(0,l.createElement)("option",{value:"nl"},(0,m.__)("Dutch","store-locator-widget-block")),(0,l.createElement)("option",{value:"en"},(0,m.__)("English","store-locator-widget-block")),(0,l.createElement)("option",{value:"fr"},(0,m.__)("French","store-locator-widget-block")),(0,l.createElement)("option",{value:"el"},(0,m.__)("Greek","store-locator-widget-block")),(0,l.createElement)("option",{value:"he"},(0,m.__)("Hebrew","store-locator-widget-block")),(0,l.createElement)("option",{value:"it"},(0,m.__)("Italian","store-locator-widget-block")),(0,l.createElement)("option",{value:"ja"},(0,m.__)("Japanese","store-locator-widget-block")),(0,l.createElement)("option",{value:"pl"},(0,m.__)("Polish","store-locator-widget-block")),(0,l.createElement)("option",{value:"pt"},(0,m.__)("Portuguese","store-locator-widget-block")),(0,l.createElement)("option",{value:"ro"},(0,m.__)("Romanian","store-locator-widget-block")),(0,l.createElement)("option",{value:"ru"},(0,m.__)("Russian","store-locator-widget-block")),(0,l.createElement)("option",{value:"es"},(0,m.__)("Spanish","store-locator-widget-block")),(0,l.createElement)("option",{value:"sv"},(0,m.__)("Swedish","store-locator-widget-block")),(0,l.createElement)("option",{value:"uk"},(0,m.__)("Ukrainian","store-locator-widget-block"))),(0,l.createElement)(c.SelectControl,{label:(0,m.__)("Period","store-locator-widget-block"),value:t.period,onChange:e=>o({internationalization:{...t,lang:t.lang,period:e,unitSystem:t.unitSystem}})},(0,l.createElement)("option",{value:"fr"},(0,m.__)("24h","store-locator-widget-block")),(0,l.createElement)("option",{value:"en-US"},(0,m.__)("12h","store-locator-widget-block"))),(0,l.createElement)(c.SelectControl,{label:(0,m.__)("Unit System","store-locator-widget-block"),value:t.unitSystem,onChange:e=>o({internationalization:{...t,lang:t.lang,period:t.period,unitSystem:Number(e)}})},(0,l.createElement)("option",{value:"0"},(0,m.__)("Metric","store-locator-widget-block")),(0,l.createElement)("option",{value:"1"},(0,m.__)("Imperial","store-locator-widget-block"))))}function M(e){const{isAuthenticated:t}=e;return t?(0,l.createElement)(u.InspectorControls,null,(0,l.createElement)(C,{...e}),(0,l.createElement)(P,{...e}),(0,l.createElement)(S,{...e}),(0,l.createElement)(A,{...e})):(0,l.createElement)(u.InspectorControls,null,(0,l.createElement)(c.PanelBody,null,(0,l.createElement)("p",null,(0,m.__)("You need to confirm your access to Woosmap before you can continue.","store-locator-widget-block"))))}function T({setApiKey:e}){const[t,o]=(0,d.useState)(""),[r,a]=(0,d.useState)(!1),i=(0,p.useSelect)((e=>e("core").getEntityRecord("root","site")),[]);return(0,d.useEffect)((()=>{if(i){const{woosmap_settings:{woosmap_public_api_key:e}}=i;o(e)}}),[i]),(0,l.createElement)(l.Fragment,null,(0,l.createElement)(c.TextControl,{label:(0,m.__)("Please enter your Public API Key","store-locator-widget-block"),readOnly:r,name:"woosmap_public_api_key",value:t,onChange:e=>o(e)}),(0,l.createElement)(c.Button,{isPrimary:!0,disabled:r,isBusy:r,onClick:()=>{a(!0),(0,p.dispatch)("core").saveEntityRecord("root","site",{woosmap_settings:{woosmap_public_api_key:t}}).then((({woosmap_settings:{woosmap_public_api_key:t}})=>{o(t),a(!1),e(t),window.dispatchEvent(new CustomEvent("woosmapSettingsSaved"))})).catch((e=>{(0,p.dispatch)("core/notices").createErrorNotice(e.message,{isDismissible:!0,type:"snackbar"}),a(!1)}))}},(0,m.__)("Confirm Woosmap Credentials","store-locator-widget-block")))}(0,p.register)(v);const L={top:!1,right:!1,bottom:!0,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1};function z({onResizeStart:e,onResize:t,onResizeStop:o,...r}){const[a,i]=(0,d.useState)(!1);return(0,l.createElement)(c.ResizableBox,{style:{position:"absolute",top:0,left:0,right:0,bottom:0},className:"store-locator-widget-block__resize-container "+(a?"is-resizing":""),enable:L,onResizeStart:(o,r,a)=>{e(a.clientHeight),t(a.clientHeight)},onResize:(e,o,r)=>{t(r.clientHeight),a||i(!0)},onResizeStop:(e,t,r)=>{o(r.clientHeight),i(!1)},minHeight:250,...r})}function R({blockProps:e,BlockIcon:t,initialConfig:o,onValidateConfig:r}){const{height:a,apiKey:i,...n}=o,[s,g]=(0,d.useState)(JSON.stringify(n,null,2)),h=(0,d.useCallback)((()=>{try{const e=function(e){const t=e.replace(/'/g,'"').replace(/([,{]\s*)([a-zA-Z0-9_]+):/g,'$1"$2":').replace(/\b(true|false|null)\b/g,(e=>e.toLowerCase())).replace(/,\s*([}\]])/g,"$1").trim();try{return JSON.stringify(JSON.parse(t),null,2)}catch(e){throw new Error("Failed to process input config into valid JSON: "+e.message)}}(s);g(e);const t=JSON.parse(e);r(t)}catch(e){const t=`Invalid Widget Conf format: ${e.message}`;(0,p.dispatch)("core/notices").createErrorNotice(t,{isDismissible:!0,type:"snackbar"})}}),[s,r]);return(0,l.createElement)("div",{...e},(0,l.createElement)(c.Placeholder,{label:(0,m.__)("Store Locator Widget Configuration","store-locator-widget-block"),icon:t},(0,l.createElement)("pre",{id:"store-locator-widget-conf"},(0,l.createElement)(u.RichText,{value:s,onChange:e=>g(e),placeholder:(0,m.__)("Write json conf…"),"aria-label":(0,m.__)("Conf"),preserveWhiteSpace:!0,allowedFormats:[],withoutInteractiveFormatting:!0,__unstablePastePlainText:!0})),(0,l.createElement)(c.Button,{isPrimary:!0,onClick:h,style:{marginTop:"10px"}},(0,m.__)("Validate Configuration","store-locator-widget-block"))))}const W=(0,d.memo)((e=>{const{storeLocatorWidget:t,isAuthenticated:o,clientId:r,setAttributes:a,setStoreLocatorWidget:i,webAppLib:n,apiKey:s}=e,c=!!t,m=(0,g.useRefEffect)((e=>{if(n)return o&&!c&&i(new f(e,r,a)),()=>{c&&(t.remove(),i(null))}}),[n,s,o,t,r,a]);return(0,l.createElement)("div",{id:"storeLocatorWidgetEdit",ref:m})}));(0,i.registerBlockType)(s,{attributes:{...s.attributes},icon:n,edit:function(e){const{attributes:t,setAttributes:o,clientId:r,isSelected:a}=e,{height:i,apiKey:s}=t,[h,b]=(0,d.useState)(null),[w,y]=(0,d.useState)(null),[f,k]=(0,d.useState)(s),_=!!h,[E,C]=(0,d.useState)(!0),[S,x]=(0,d.useState)(!1),A=(0,p.useSelect)((e=>e(v).isAuthenticated())),{updateAuthenticationStatus:P}=(0,p.useDispatch)(v),{toggleSelection:L}=(0,p.useDispatch)(u.store),N=(0,g.useDebounce)((e=>{h.update(e)}),500),D=(0,g.useRefEffect)((e=>{const t=!!e.ownerDocument.defaultView.WebApp;if(!t)return void y(null);y(t);const o=()=>{(({status:e})=>{"Initialized"===e&&(C(!1),P(!0))})({status:"Initialized"})};return t&&(C(!1),f&&o()),window.addEventListener("woosmapSettingsSaved",o),()=>{window.removeEventListener("woosmapSettingsSaved",o),y(null)}}));(0,d.useEffect)((()=>{A&&C(!1)}),[A]),(0,d.useEffect)((()=>{A&&_&&N(t)}),[t,A,h,_]);const I=(0,u.useBlockProps)({ref:D});return E?(0,l.createElement)("div",{...I},(0,l.createElement)(c.Placeholder,{style:{height:`${i}px`},label:(0,m.__)("Block for Woosmap Store Locator Widget","store-locator-widget-block"),icon:n},(0,l.createElement)(c.Spinner,null))):A?S?(0,l.createElement)(R,{blockProps:I,BlockIcon:n,initialConfig:t,onValidateConfig:e=>{o(e),x(!1)}}):(0,l.createElement)(l.Fragment,null,(0,l.createElement)(u.BlockControls,null,(0,l.createElement)(c.ToolbarGroup,null,(0,l.createElement)(c.ToolbarButton,{icon:"admin-generic",label:(0,m.__)("Show Configuration","store-locator-widget-block"),onClick:()=>x(!S)}))),(0,l.createElement)(M,{...e,isAuthenticated:A,storeLocatorWidget:h,webAppLib:w}),(0,l.createElement)("div",{...I},(0,l.createElement)(z,{onResizeStart:()=>{L(!1)},onResize:e=>{h.update({height:e},!1)},onResizeStop:e=>{o({height:e}),L(!0)},showHandle:a,size:{height:i}}),(0,l.createElement)(W,{clientId:r,setAttributes:o,isAuthenticated:A,webAppLib:w,storeLocatorWidget:h,setStoreLocatorWidget:b,apiKey:f}))):(0,l.createElement)(l.Fragment,null,(0,l.createElement)(M,{...e,isAuthenticated:A,storeLocatorWidget:h,webAppLib:w}),(0,l.createElement)("div",{...I},(0,l.createElement)(c.Placeholder,{style:{minHeight:`${i}px`},label:(0,m.__)("Authorize Woosmap Access","store-locator-widget-block"),icon:n,isColumnLayout:!0},(0,l.createElement)("div",{style:{marginBottom:"1em"}},(0,m.__)("To embed a Woosmap Store Locator Widget in your website, you need to provide your Public API Key. Follow the instructions in the documentation to obtain this key: ","store-locator-widget-block"),(0,l.createElement)("a",{href:"https://developers.woosmap.com/support/api-keys/#registering-a-woosmap-public-api-key",target:"_blank",rel:"noopener noreferrer"},(0,m.__)("Guide to register a Woosmap Public API Key.","store-locator-widget-block"))),(0,l.createElement)(T,{setApiKey:e=>{k(e),o({apiKey:e})}}))))},save:function(e){const{attributes:{height:t,apiKey:o,theme:r,internationalization:a,woosmapView:i,customMarkers:n,filters:s}}=e,c=u.useBlockProps.save({style:{height:`${t}px`},id:"storeLocatorWidget"});return(0,l.createElement)("div",{...c,"data-api-key":o,"data-theme":JSON.stringify(r),"data-internationalization":JSON.stringify(a),"data-woosmap-view":JSON.stringify(i),"data-custom-markers":JSON.stringify(n),"data-filters":JSON.stringify(s)})}})}},o={};function r(e){var a=o[e];if(void 0!==a)return a.exports;var i=o[e]={exports:{}};return t[e](i,i.exports,r),i.exports}r.m=t,e=[],r.O=(t,o,a,i)=>{if(!o){var l=1/0;for(m=0;m<e.length;m++){for(var[o,a,i]=e[m],n=!0,s=0;s<o.length;s++)(!1&i||l>=i)&&Object.keys(r.O).every((e=>r.O[e](o[s])))?o.splice(s--,1):(n=!1,i<l&&(l=i));if(n){e.splice(m--,1);var c=a();void 0!==c&&(t=c)}}return t}i=i||0;for(var m=e.length;m>0&&e[m-1][2]>i;m--)e[m]=e[m-1];e[m]=[o,a,i]},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={57:0,350:0};r.O.j=t=>0===e[t];var t=(t,o)=>{var a,i,[l,n,s]=o,c=0;if(l.some((t=>0!==e[t]))){for(a in n)r.o(n,a)&&(r.m[a]=n[a]);if(s)var m=s(r)}for(t&&t(o);c<l.length;c++)i=l[c],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return r.O(m)},o=globalThis.webpackChunkstore_locator_widget_block=globalThis.webpackChunkstore_locator_widget_block||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var a=r.O(void 0,[350],(()=>r(660)));a=r.O(a)})();