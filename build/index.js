(()=>{"use strict";var e,t={812:(e,t,o)=>{var i={};o.r(i),o.d(i,{isAuthenticated:()=>f});var r={};o.r(r),o.d(r,{updateAuthenticationStatus:()=>y});const n=window.wp.blocks,a=window.React,s=function(){return(0,a.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 771.444"},(0,a.createElement)("rect",{x:"427.842",width:"166.721",height:"172.249",fill:"#4FC3F7"}),(0,a.createElement)("rect",{x:"338.962",y:"172.249",width:"255.601",height:"166.721",fill:"#5586FF"}),(0,a.createElement)("rect",{x:"172.241",y:"172.249",width:"166.721",height:"255.609",fill:"#3D5AFE"}),(0,a.createElement)("rect",{y:"427.858",width:"338.962",height:"166.721",fill:"#3949AB"}),(0,a.createElement)("rect",{x:"851.743",y:"176.865",width:"172.257",height:"166.721",fill:"#FFAB00"}),(0,a.createElement)("rect",{x:"685.022",y:"176.865",width:"166.721",height:"255.609",fill:"#FF5252"}),(0,a.createElement)("rect",{x:"596.142",y:"432.474",width:"255.601",height:"166.721",fill:"#F50057"}),(0,a.createElement)("rect",{x:"429.421",y:"432.483",width:"166.721",height:"338.961",fill:"#C51162"}))},l=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"woosmap/wp-store-locator-widget-block","version":"0.1.0","title":"Woosmap Store Locator Widget Block","category":"widgets","keywords":["Woosmap","Store Locator","Store Finder","Map"],"description":"Easily display your stores on a Map using Woosmap platform","example":{},"supports":{"align":["wide","full"],"spacing":{"margin":true},"html":false},"attributes":{"apiKey":{"type":"string","default":"woos-48c80350-88aa-333e-835a-07f4b658a9a4"},"height":{"type":"string","default":"450"},"latitude":{"type":"number","default":51.48762585296625},"longitude":{"type":"number","default":-0.1326724377053381},"zoom":{"type":"number","default":6}},"textdomain":"wp-store-locator-widget-block","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css","viewScript":"file:./view.js","script":"woosmap-webapp-js"}'),c=window.wp.components,d=window.wp.i18n,u=window.wp.blockEditor,p=window.wp.element,m=window.wp.data,h=window.wp.compose;window.wp.apiFetch;class g{constructor(e){this.element=e,this.storeLocatorConfig={},this.webAppLib=e.ownerDocument.defaultView.WebApp,this.webAppLib&&this.init()}init(){this.createStoreLocatorWidget()}createStoreLocatorWidget(){const{latitude:e,longitude:t,zoom:o,apiKey:i}=this.element.dataset;this.storeLocatorConfig={theme:{primary_color:"#000"},maps:{provider:"woosmap"},woosmapview:{initialCenter:{lat:Number(e)||48.967529,lng:Number(t)||2.368438},initialZoom:Number(o)||5},datasource:{max_responses:10,max_distance:5e4}},this.storeLocatorWidget=new this.webAppLib(this.element.id,"woos-0c78592f-13ea-362b-aa07-ba4ba9ea3dae"),this.storeLocatorWidget.setConf(this.storeLocatorConfig),this.storeLocatorWidget.isMobile=!1,this.storeLocatorWidget.confHandler.setInitConf(this.storeLocatorConfig)}}class w extends g{constructor(e,t,o){super(e),this.isEditor=!0,this.clientId=t,this.setAttributes=o,this.initEdit()}initEdit(){this.addListeners()}remove(){this.storeLocatorWidget&&(this.element.parentNode.removeChild(this.element),this.storeLocatorWidget=null)}addListeners(){this.element.addEventListener("click",(()=>{(0,m.dispatch)("core/block-editor").selectBlock(this.clientId)}))}update(e){const{height:t,latitude:o,longitude:i,zoom:r,apiKey:n}=e;t&&(this.element.style.height=`${t}px`),o&&(this.element.dataset.latitude=o),i&&(this.element.dataset.longitude=i),r&&(this.element.dataset.zoom=r),n&&(this.element.dataset.apiKey=n,this.init())}}const b=(0,m.combineReducers)({authenticationReducer:function(e,t){return"UPDATE_AUTHENTICATION"===t.type?{...e,authenticated:t.isAuthenticated}:e}});function f(e){return Boolean(e?.authenticationReducer?.authenticated)}function y(e){return{type:"UPDATE_AUTHENTICATION",isAuthenticated:e}}const E=(0,m.createReduxStore)("woosmap/wp-store-locator-widget-block",{reducer:b,selectors:i,actions:r});function v(e){const{attributes:{height:t,zoom:o},setAttributes:i}=e;return(0,a.createElement)(c.PanelBody,{title:(0,d.__)("Display Settings","wp-store-locator-widget-block")},(0,a.createElement)(c.RangeControl,{label:(0,d.__)("Zoom","wp-store-locator-widget-block"),value:o,onChange:e=>i({zoom:e}),min:0,max:20,step:.5}),(0,a.createElement)(c.TextControl,{label:(0,d.__)("Height ( pixels )","wp-store-locator-widget-block"),value:t,onChange:e=>i({height:e})}))}function _(e){const{isAuthenticated:t}=e;return t?(0,a.createElement)(u.InspectorControls,null,(0,a.createElement)(v,{...e})):(0,a.createElement)(u.InspectorControls,null,(0,a.createElement)(c.PanelBody,null,(0,a.createElement)("p",null,(0,d.__)("You need to confirm your access to Woosmap before you can continue.","wp-store-locator-widget-block"))))}function k(){const[e,t]=(0,p.useState)(""),[o,i]=(0,p.useState)(!1),r=(0,m.useSelect)((e=>e("core").getEntityRecord("root","site")),[]);return(0,p.useEffect)((()=>{if(r){const{woosmap_settings:{woosmap_public_api_key:e}}=r;t(e)}}),[r]),(0,a.createElement)(a.Fragment,null,(0,a.createElement)(c.TextControl,{label:(0,d.__)("Please enter your Public API Key","wp-store-locator-widget-block"),readOnly:o,name:"woosmap_public_api_key",value:e,onChange:e=>t(e)}),(0,a.createElement)(c.Button,{isPrimary:!0,disabled:o,isBusy:o,onClick:()=>{i(!0),(0,m.dispatch)("core").saveEntityRecord("root","site",{woosmap_settings:{woosmap_public_api_key:e}}).then((({woosmap_settings:{woosmap_public_api_key:e}})=>{t(e),i(!1),window.dispatchEvent(new CustomEvent("woosmapSettingsSaved"))})).catch((e=>{(0,m.dispatch)("core/notices").createErrorNotice(e.message,{isDismissible:!0,type:"snackbar"}),i(!1)}))}},(0,d.__)("Confirm Woosmap Credentials","wp-store-locator-widget-block")))}(0,m.register)(E);const S={top:!1,right:!1,bottom:!0,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1};function A({onResizeStart:e,onResize:t,onResizeStop:o,...i}){const[r,n]=(0,p.useState)(!1);return(0,a.createElement)(c.ResizableBox,{style:{position:"absolute",top:0,left:0,right:0,bottom:0},className:"wp-store-locator-widget-block__resize-container "+(r?"is-resizing":""),enable:S,onResizeStart:(o,i,r)=>{e(r.clientHeight),t(r.clientHeight)},onResize:(e,o,i)=>{t(i.clientHeight),r||n(!0)},onResizeStop:(e,t,i)=>{o(i.clientHeight),n(!1)},minHeight:100,...i})}const L=(0,p.memo)((e=>{const{storeLocatorWidget:t,isAuthenticated:o,clientId:i,setAttributes:r,setStoreLocatorWidget:n,webAppLib:s}=e,l=!!t,c=(0,h.useRefEffect)((e=>{if(s)return o&&!l&&n(new w(e,i,r)),()=>{l&&(t.remove(),n(null))}}),[s,o,t,i,r]);return(0,a.createElement)("div",{id:"storeLocatorWidgetEdit",ref:c})}));(0,n.registerBlockType)(l,{attributes:{...l.attributes},icon:s,edit:function(e){const{attributes:t,setAttributes:o,clientId:i,isSelected:r}=e,{height:n}=t,[l,g]=(0,p.useState)(null),[w,b]=(0,p.useState)(null),f=!!l,[y,v]=(0,p.useState)(!0),S=(0,m.useSelect)((e=>e(E).isAuthenticated())),{updateAuthenticationStatus:x}=(0,m.useDispatch)(E),{toggleSelection:W}=(0,m.useDispatch)(u.store),C=(0,h.useRefEffect)((e=>{const t=!!e.ownerDocument.defaultView.WebApp;if(!t)return void b(null);b(t);const o=()=>{(({status:e})=>{"Initialized"===e&&(v(!1),x(!0))})({status:"Initialized"})};return t&&v(!1),window.addEventListener("woosmapSettingsSaved",o),()=>{window.removeEventListener("woosmapSettingsSaved",o),b(null)}}));(0,p.useEffect)((()=>{S&&v(!1)}),[S]),(0,p.useEffect)((()=>{S&&f&&l.update(t)}),[t,S,l]);const z=(0,u.useBlockProps)({ref:C});return y?(0,a.createElement)("div",{...z},(0,a.createElement)(c.Placeholder,{style:{height:`${n}px`},label:(0,d.__)("Block for Woosmap Store Locator Widget","wp-store-locator-widget-block"),icon:s},(0,a.createElement)(c.Spinner,null))):S?(0,a.createElement)(a.Fragment,null,(0,a.createElement)(_,{...e,isAuthenticated:S,storeLocatorWidget:l,webAppLib:w}),(0,a.createElement)("div",{...z},(0,a.createElement)(A,{onResizeStart:()=>{W(!1)},onResize:e=>{l.update({height:e})},onResizeStop:e=>{o({height:e}),W(!0)},showHandle:r,size:{height:n}}),(0,a.createElement)(L,{clientId:i,setAttributes:o,isAuthenticated:S,webAppLib:w,storeLocatorWidget:l,setStoreLocatorWidget:g}))):(0,a.createElement)(a.Fragment,null,(0,a.createElement)(_,{...e,isAuthenticated:S,storeLocatorWidget:l,webAppLib:w}),(0,a.createElement)("div",{...z},(0,a.createElement)(c.Placeholder,{style:{minHeight:`${n}px`},label:(0,d.__)("Authorize Woosmap Access","wp-store-locator-widget-block"),icon:s,isColumnLayout:!0},(0,a.createElement)("div",{style:{marginBottom:"1em"}},(0,d.__)("To embed a Woosmap Store Locator Widget in your website, you need to provide your Public API Key. Follow the instructions in the documentation to obtain this key: ","wp-store-locator-widget-block"),(0,a.createElement)("a",{href:"https://developers.woosmap.com/support/api-keys/#registering-a-woosmap-public-api-key",target:"_blank",rel:"noopener noreferrer"},(0,d.__)("Guide to register a Woosmap Public API Key.","wp-store-locator-widget-block"))),(0,a.createElement)(k,null))))},save:function(e){const{attributes:{height:t,latitude:o,longitude:i,zoom:r,apiKey:n}}=e,s=u.useBlockProps.save({style:{height:`${t}px`},id:"storeLocatorWidget"});return(0,a.createElement)("div",{...s,"data-latitude":o,"data-longitude":i,"data-zoom":r,"data-api-key":n})}})}},o={};function i(e){var r=o[e];if(void 0!==r)return r.exports;var n=o[e]={exports:{}};return t[e](n,n.exports,i),n.exports}i.m=t,e=[],i.O=(t,o,r,n)=>{if(!o){var a=1/0;for(d=0;d<e.length;d++){for(var[o,r,n]=e[d],s=!0,l=0;l<o.length;l++)(!1&n||a>=n)&&Object.keys(i.O).every((e=>i.O[e](o[l])))?o.splice(l--,1):(s=!1,n<a&&(a=n));if(s){e.splice(d--,1);var c=r();void 0!==c&&(t=c)}}return t}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[o,r,n]},i.d=(e,t)=>{for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={57:0,350:0};i.O.j=t=>0===e[t];var t=(t,o)=>{var r,n,[a,s,l]=o,c=0;if(a.some((t=>0!==e[t]))){for(r in s)i.o(s,r)&&(i.m[r]=s[r]);if(l)var d=l(i)}for(t&&t(o);c<a.length;c++)n=a[c],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(d)},o=globalThis.webpackChunkwp_store_locator_widget_block=globalThis.webpackChunkwp_store_locator_widget_block||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var r=i.O(void 0,[350],(()=>i(812)));r=i.O(r)})();