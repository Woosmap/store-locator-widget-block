(()=>{"use strict";var e,t={415:(e,t,o)=>{var r={};o.r(r),o.d(r,{isAuthenticated:()=>f});var i={};o.r(i),o.d(i,{updateAuthenticationStatus:()=>E});const l=window.wp.blocks,a=window.React,n=function(){return(0,a.createElement)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 771.444"},(0,a.createElement)("rect",{x:"427.842",width:"166.721",height:"172.249",fill:"#4FC3F7"}),(0,a.createElement)("rect",{x:"338.962",y:"172.249",width:"255.601",height:"166.721",fill:"#5586FF"}),(0,a.createElement)("rect",{x:"172.241",y:"172.249",width:"166.721",height:"255.609",fill:"#3D5AFE"}),(0,a.createElement)("rect",{y:"427.858",width:"338.962",height:"166.721",fill:"#3949AB"}),(0,a.createElement)("rect",{x:"851.743",y:"176.865",width:"172.257",height:"166.721",fill:"#FFAB00"}),(0,a.createElement)("rect",{x:"685.022",y:"176.865",width:"166.721",height:"255.609",fill:"#FF5252"}),(0,a.createElement)("rect",{x:"596.142",y:"432.474",width:"255.601",height:"166.721",fill:"#F50057"}),(0,a.createElement)("rect",{x:"429.421",y:"432.483",width:"166.721",height:"338.961",fill:"#C51162"}))},c=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"woosmap/wp-store-locator-widget-block","version":"0.1.0","title":"Woosmap Store Locator Widget Block","category":"widgets","keywords":["Woosmap","Store Locator","Store Finder","Map"],"description":"Easily display your stores on a Map using Woosmap platform","example":{},"supports":{"align":["wide","full"],"spacing":{"margin":true},"html":false,"multiple":false},"attributes":{"height":{"type":"string","default":"500"},"apiKey":{"type":"string"},"theme":{"type":"object","properties":{"primary_color":{"type":"string","default":"#000"}},"default":{"primary_color":"#000"}},"internationalization":{"type":"object","properties":{"lang":{"type":"string","default":"en"},"period":{"type":"string","default":"fr"},"unitSystem":{"type":"number","default":0}},"default":{"lang":"en","period":"fr","unitSystem":0}},"woosmapView":{"type":"object","default":{"initialCenter":{"lat":50,"lng":0},"initialZoom":6}},"tileColor":{"type":"string","default":"#000"},"tileSize":{"type":"number","default":11},"breakPoint":{"type":"number","default":10},"defaultStyle":{"type":"object","properties":{"icon":{"type":"object","properties":{"url":{"type":"string","default":"https://images.woosmap.com/marker-default.svg"}},"default":{"url":"https://images.woosmap.com/marker-default.svg"}},"selectedIcon":{"type":"object","properties":{"url":{"type":"string","default":"https://images.woosmap.com/marker-selected.svg"}},"default":{"url":"https://images.woosmap.com/marker-selected.svg"}},"numberedIcon":{"type":"object","properties":{"url":{"type":"string","default":"https://images.woosmap.com/marker-default.svg"}},"default":{"url":"https://images.woosmap.com/marker-default.svg"}}},"default":{"icon":{"url":"https://images.woosmap.com/marker-default.svg"},"selectedIcon":{"url":"https://images.woosmap.com/marker-selected.svg"},"numberedIcon":{"url":"https://images.woosmap.com/marker-default.svg"}}},"customMarkers":{"type":"array","default":[],"items":{"type":"object","properties":{"storeType":{"type":"string"},"customTyleColor":{"type":"string"},"customDefaultMarkerUrl":{"type":"string"},"customSelectedMarkerUrl":{"type":"string"},"customNumberedMarkerUrl":{"type":"string"}}}},"filtersOpened":{"type":"boolean","default":false},"filtersCustomOrder":{"type":"boolean","default":false},"filters":{"type":"array","default":[],"items":{"type":"object","properties":{"propertyType":{"type":"string"},"title":{"type":"string"},"innerOperator":{"type":"string"},"choices":{"type":"array","default":[],"items":{"type":"object","properties":{"choiceKey":{"type":"string"},"choiceTitle":{"type":"string"},"choiceSelected":{"type":"boolean"},"choiceHidden":{"type":"boolean"}}}}}}},"filtersOuterOperator":{"type":"string","default":"or"}},"textdomain":"wp-store-locator-widget-block","editorScript":"file:./index.js","editorStyle":"file:./index.css","style":"file:./style-index.css","viewScript":"file:./view.js","script":"woosmap-webapp-js"}'),s=window.wp.components,p=window.wp.i18n,d=window.wp.blockEditor,m=window.wp.element,u=window.wp.data,g=window.wp.compose;function b(e,t={}){try{return JSON.parse(e)||t}catch(e){return console.warn("JSON parsing error:",e),t}}function h(e=[]){return e.map((e=>({type:e.storeType||"store_type",color:e.customTyleColor||"#000",icon:{url:e.customDefaultMarkerUrl||"https://images.woosmap.com/marker-default.svg"},selectedIcon:{url:e.customSelectedMarkerUrl||"https://images.woosmap.com/marker-selected.svg"},numberedIcon:{url:e.customNumberedMarkerUrl||"https://images.woosmap.com/marker-default.svg"}})))}function w(e=[]){return e.map((e=>({propertyType:e.propertyType||"propertyType",title:{en:e.title||"title"},choices:e.choices.map((e=>({key:e.choiceKey||"choiceKey",en:e.choiceTitle||"choiceTitle",selected:e.choiceSelected||!1,hidden:e.choiceHidden||!1})))||[],innerOperator:e.innerOperator||"and"})))}class y{constructor(e){this.element=e,this.storeLocatorConfig={},this.webAppLib=e.ownerDocument.defaultView.WebApp,this.webAppLib&&this.element.dataset.apiKey&&this.init()}init(){this.createStoreLocatorWidget()}createStoreLocatorWidget(){const e=function(e){const{customMarkers:t="[]",filters:o="[]",theme:r="{}",internationalization:i="{}",woosmapView:l="{}",defaultStyle:a="{}",apiKey:n,tileColor:c="#000",tileSize:s="11",breakPoint:p="10",filtersOpened:d="false",filtersCustomOrder:m="false",filtersOuterOperator:u="or"}=e,g=b(l,{initialCenter:{lat:50,lng:0},initialZoom:13});return{theme:b(r,{primary_color:"#000"}),datasource:{max_responses:5,max_distance:5e4},internationalization:b(i,{lang:"en",period:"fr",unitSystem:0}),maps:{apiKey:n,provider:"woosmap"},woosmapview:{initialCenter:g.initialCenter,initialZoom:g.initialZoom,tileStyle:{color:c,size:Number(s),minSize:5,typeRules:h(b(t))},breakPoint:Number(p),style:{rules:h(b(t)),default:b(a,{icon:{url:"https://images.woosmap.com/marker-default.svg"},selectedIcon:{url:"https://images.woosmap.com/marker-selected.svg"},numberedIcon:{url:"https://images.woosmap.com/marker-default.svg"}})}},filters:{opened:"true"===d,customOrder:"true"===m,filters:w(b(o)),outerOperator:u}}}(this.element.dataset);this.storeLocatorConfig=function(e){if(!e.maps.apiKey)throw new Error("StoreLocator configuration error: apiKey is required.");return e}(e),this.element.innerHTML="";const t=document.createElement("div");t.style="width:100%; height:100%",t.id="store-locator-widget-id",this.element.appendChild(t),this.storeLocatorWidget&&(this.storeLocatorWidget.isMobile=!1,this.storeLocatorWidget.confHandler.setInitConf(this.storeLocatorConfig)),this.storeLocatorWidget=new this.webAppLib(t.id,this.storeLocatorConfig.maps.apiKey),this.storeLocatorWidget.isMobile=!1,this.storeLocatorWidget.confHandler.setInitConf(this.storeLocatorConfig)}}class k extends y{constructor(e,t,o){super(e),this.isEditor=!0,this.clientId=t,this.setAttributes=o,this.initEdit()}initEdit(){this.addListeners()}remove(){this.storeLocatorWidget&&(this.element.parentNode.removeChild(this.element),this.storeLocatorWidget=null)}addListeners(){this.element.addEventListener("click",(()=>{(0,u.dispatch)("core/block-editor").selectBlock(this.clientId)}))}updateDatasetProperty(e,t){this.element.dataset[e]="object"==typeof t?JSON.stringify(t):t}update(e,t=!0){Object.entries(e).forEach((([e,t])=>{"height"===e?this.element.style.height=`${t}px`:this.updateDatasetProperty(e,t)})),t&&this.init()}}const _=(0,u.combineReducers)({authenticationReducer:function(e,t){return"UPDATE_AUTHENTICATION"===t.type?{...e,authenticated:t.isAuthenticated}:e}});function f(e){return Boolean(e?.authenticationReducer?.authenticated)}function E(e){return{type:"UPDATE_AUTHENTICATION",isAuthenticated:e}}const C=(0,u.createReduxStore)("woosmap/wp-store-locator-widget-block",{reducer:_,selectors:r,actions:i});function v(e){const{attributes:{height:t,theme:o,woosmapView:r},setAttributes:i}=e;return(0,a.createElement)(s.PanelBody,{title:(0,p.__)("Display Settings","wp-store-locator-widget-block")},(0,a.createElement)(s.PanelRow,null,(0,a.createElement)("label",{htmlFor:"theme-color-control"},(0,p.__)("Primary Color","wp-store-locator-widget-block")),(0,a.createElement)(s.ColorIndicator,{id:"theme-color-control",colorValue:o.primary_color})),(0,a.createElement)(s.ColorPalette,{value:o.primary_color,onChange:e=>i({theme:{primary_color:e}})}),(0,a.createElement)(s.RangeControl,{label:(0,p.__)("Zoom","wp-store-locator-widget-block"),value:r.initialZoom,onChange:e=>i({woosmapView:{...r,initialZoom:e}}),min:0,max:20,step:.5}),(0,a.createElement)(s.RangeControl,{label:(0,p.__)("Height ( pixels )","wp-store-locator-widget-block"),value:Number(t),onChange:e=>i({height:e}),min:250,max:3e3,step:5}),(0,a.createElement)(s.RangeControl,{label:(0,p.__)("Default Latitude","wp-store-locator-widget-block"),value:r.initialCenter.lat,onChange:e=>i({woosmapView:{...r,initialCenter:{...r.initialCenter,lat:e}}}),min:-90,max:90,step:.1}),(0,a.createElement)(s.RangeControl,{label:(0,p.__)("Default Longitude","wp-store-locator-widget-block"),value:r.initialCenter.lng,onChange:e=>i({woosmapView:{...r,initialCenter:{...r.initialCenter,lng:e}}}),min:-180,max:180,step:.1}))}function S(e){const{attributes:{tileColor:t,breakPoint:o,tileSize:r,defaultStyle:i},setAttributes:l}=e;return(0,a.createElement)(s.PanelBody,{title:(0,p.__)("Marker Settings","wp-store-locator-widget-block"),initialOpen:!1},(0,a.createElement)(s.PanelRow,null,(0,a.createElement)("label",{htmlFor:"tile-color-control"},(0,p.__)("Tile Color","wp-store-locator-widget-block")),(0,a.createElement)(s.ColorIndicator,{id:"tile-color-control",colorValue:t})),(0,a.createElement)(s.ColorPalette,{value:t,onChange:e=>l({tileColor:e})}),(0,a.createElement)(s.RangeControl,{label:(0,p.__)("Tile Size","wp-store-locator-widget-block"),value:r,onChange:e=>l({tileSize:e}),min:1,max:50,step:1}),(0,a.createElement)(s.RangeControl,{label:(0,p.__)("Break Point","wp-store-locator-widget-block"),value:o,onChange:e=>l({breakPoint:e}),min:1,max:20,step:1}),(0,a.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,a.createElement)(s.TextControl,{label:(0,p.__)("Default Marker Url","wp-store-locator-widget-block"),value:i.icon.url,onChange:e=>l({defaultStyle:{icon:{url:e},selectedIcon:{url:i.selectedIcon.url},numberedIcon:{url:i.numberedIcon.url}}})}),i.icon.url&&(0,a.createElement)("img",{src:i.icon.url,alt:"Default Marker Url",style:{maxWidth:"100%",height:"auto"}})),(0,a.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,a.createElement)(s.TextControl,{label:(0,p.__)("Selected Marker Url","wp-store-locator-widget-block"),value:i.selectedIcon.url,onChange:e=>l({defaultStyle:{icon:{url:i.icon.url},selectedIcon:{url:e},numberedIcon:{url:i.numberedIcon.url}}})}),i.selectedIcon.url&&(0,a.createElement)("img",{src:i.selectedIcon.url,alt:"Selected Marker Url",style:{maxWidth:"100%",height:"auto"}})),(0,a.createElement)("div",{style:{padding:10,border:"1px solid lightgray",borderRadius:5}},(0,a.createElement)(s.TextControl,{label:(0,p.__)("Numbered Marker Url","wp-store-locator-widget-block"),value:i.numberedIcon.url,onChange:e=>l({defaultStyle:{icon:{url:i.icon.url},selectedIcon:{url:i.selectedIcon.url},numberedIcon:{url:e}}})}),i.numberedIcon.url&&(0,a.createElement)("img",{src:i.numberedIcon.url,alt:"Numbered Marker Url",style:{maxWidth:"100%",height:"auto"}})))}function T(e){const{index:t,marker:o,storeType:r,customTyleColor:i,customDefaultMarkerUrl:l,customSelectedMarkerUrl:n,customNumberedMarkerUrl:c,customMarkers:d,setAttributes:m}=e,g=e=>{const o=d.map(((o,r)=>r===t?e:o));m({customMarkers:o})};return(0,a.createElement)(s.PanelBody,{title:(0,p.__)("Edit: ","wp-store-locator-widget-block")+r,initialOpen:!1},(0,a.createElement)(s.TextControl,{label:(0,p.__)("Store Type","wp-store-locator-widget-block"),value:r,onChange:e=>{(e=>!!e.trim()||((0,u.dispatch)("core/notices").createErrorNotice((0,p.__)("Store Type cannot be empty","wp-store-locator-widget-block"),{isDismissible:!0,type:"snackbar"}),!1))(e)&&g({...o,storeType:e})}}),(0,a.createElement)(s.PanelRow,null,(0,a.createElement)("label",{htmlFor:"custom-tile-color-control"},(0,p.__)("Custom Tile Color","wp-store-locator-widget-block")),(0,a.createElement)(s.ColorIndicator,{id:"custom-tile-color-control",colorValue:i})),(0,a.createElement)(s.ColorPalette,{value:i,onChange:e=>g({...o,customTyleColor:e})}),(0,a.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,a.createElement)(s.TextControl,{label:(0,p.__)("Custom Default Marker Url","wp-store-locator-widget-block"),value:l,onChange:e=>g({...o,customDefaultMarkerUrl:e})}),l&&(0,a.createElement)("img",{src:l,alt:"Custom Default Marker",style:{maxWidth:"100%",height:"auto"}})),(0,a.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,a.createElement)(s.TextControl,{label:(0,p.__)("Custom Selected Marker Url","wp-store-locator-widget-block"),value:n,onChange:e=>g({...o,customSelectedMarkerUrl:e})}),n&&(0,a.createElement)("img",{src:n,alt:"Custom Selected Marker",style:{maxWidth:"100%",height:"auto"}})),(0,a.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,a.createElement)(s.TextControl,{label:(0,p.__)("Custom Numbered Marker Url","wp-store-locator-widget-block"),value:c,onChange:e=>g({...o,customNumberedMarkerUrl:e})}),c&&(0,a.createElement)("img",{src:c,alt:"Custom Numbered Marker",style:{maxWidth:"100%",height:"auto"}})),(0,a.createElement)(s.Button,{variant:"primary",onClick:()=>{const e=d.filter(((e,o)=>o!==t));m({customMarkers:e})}},(0,p.__)("Delete Custom Marker","wp-store-locator-widget-block")))}function x(e){const{attributes:{customMarkers:t},setAttributes:o}=e,[r,i]=(0,m.useState)("");return(0,a.createElement)(s.PanelBody,{title:(0,p.__)("Custom Marker Settings","wp-store-locator-widget-block"),initialOpen:!1},(0,a.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,a.createElement)(s.TextControl,{label:(0,p.__)("Store Type","wp-store-locator-widget-block"),value:r,onChange:e=>i(e)}),(0,a.createElement)(s.Button,{variant:"primary",onClick:()=>{if(!r.trim())return void(0,u.dispatch)("core/notices").createErrorNotice((0,p.__)("Store Type Title cannot be empty","wp-store-locator-widget-block"),{isDismissible:!0,type:"snackbar"});const e={storeType:r,customTyleColor:"#000",customDefaultMarkerUrl:"https://images.woosmap.com/marker-default.svg",customSelectedMarkerUrl:"https://images.woosmap.com/marker-selected.svg",customNumberedMarkerUrl:"https://images.woosmap.com/marker-default.svg"},l=[...t,e];o({customMarkers:l}),i("")}},(0,p.__)("Add Custom Marker","wp-store-locator-widget-block"))),t.map(((e,r)=>(0,a.createElement)(T,{key:r,index:r,marker:e,storeType:e.storeType,customTyleColor:e.customTyleColor,customDefaultMarkerUrl:e.customDefaultMarkerUrl,customSelectedMarkerUrl:e.customSelectedMarkerUrl,customNumberedMarkerUrl:e.customNumberedMarkerUrl,customMarkers:t,setAttributes:o}))))}function O(e){const{attributes:{internationalization:t},setAttributes:o}=e;return(0,a.createElement)(s.PanelBody,{title:(0,p.__)("Internationalization Settings","wp-store-locator-widget-block"),initialOpen:!1},(0,a.createElement)(s.SelectControl,{label:(0,p.__)("Language","wp-store-locator-widget-block"),value:t.lang,onChange:e=>o({internationalization:{lang:e,period:t.period,unitSystem:t.unitSystem}})},(0,a.createElement)("option",{value:"pt-br"},(0,p.__)("Brazilian Portuguese","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"ca"},(0,p.__)("Catalan","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"zh"},(0,p.__)("Chinese","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"zh-HK"},(0,p.__)("Chinese (Hong Kong)","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"hr"},(0,p.__)("Croatian","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"de"},(0,p.__)("Deutsch","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"nl"},(0,p.__)("Dutch","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"en"},(0,p.__)("English","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"fr"},(0,p.__)("French","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"el"},(0,p.__)("Greek","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"he"},(0,p.__)("Hebrew","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"it"},(0,p.__)("Italian","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"ja"},(0,p.__)("Japanese","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"pl"},(0,p.__)("Polish","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"pt"},(0,p.__)("Portuguese","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"ro"},(0,p.__)("Romanian","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"ru"},(0,p.__)("Russian","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"es"},(0,p.__)("Spanish","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"sv"},(0,p.__)("Swedish","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"uk"},(0,p.__)("Ukrainian","wp-store-locator-widget-block"))),(0,a.createElement)(s.SelectControl,{label:(0,p.__)("Period","wp-store-locator-widget-block"),value:t.period,onChange:e=>o({internationalization:{lang:t.lang,period:e,unitSystem:t.unitSystem}})},(0,a.createElement)("option",{value:"fr"},(0,p.__)("24h","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"en-US"},(0,p.__)("12h","wp-store-locator-widget-block"))),(0,a.createElement)(s.SelectControl,{label:(0,p.__)("Unit System","wp-store-locator-widget-block"),value:t.unitSystem,onChange:e=>o({internationalization:{lang:t.lang,period:t.period,unitSystem:Number(e)}})},(0,a.createElement)("option",{value:"0"},(0,p.__)("Metric","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"1"},(0,p.__)("Imperial","wp-store-locator-widget-block"))))}function A(e){const{choiceIndex:t,choice:o,choiceKey:r,choiceTitle:i,choiceSelected:l,choiceHidden:n,choices:c,index:d,filter:m,filters:g,setAttributes:b}=e,h=e=>{const t=g.map(((t,o)=>o===d?e:t));b({filters:t})},w=e=>{const o=c.map(((o,r)=>r===t?e:o));h({...m,choices:o})};return(0,a.createElement)(s.PanelBody,{title:(0,p.__)("Choice: ","wp-store-locator-widget-block")+i+" {"+r+"}",initialOpen:!1},(0,a.createElement)(s.TextControl,{label:(0,p.__)("Choice Key","wp-store-locator-widget-block"),value:r,onChange:e=>{(e=>!!e.trim()||((0,u.dispatch)("core/notices").createErrorNotice((0,p.__)("Choice Key cannot be empty","wp-store-locator-widget-block"),{isDismissible:!0,type:"snackbar"}),!1))(e)&&w({...o,choiceKey:e})}}),(0,a.createElement)(s.TextControl,{label:(0,p.__)("Choice Tile","wp-store-locator-widget-block"),value:i,onChange:e=>{(e=>!!e.trim()||((0,u.dispatch)("core/notices").createErrorNotice((0,p.__)("Choice Title cannot be empty","wp-store-locator-widget-block"),{isDismissible:!0,type:"snackbar"}),!1))(e)&&w({...o,choiceTitle:e})}}),(0,a.createElement)(s.CheckboxControl,{label:(0,p.__)("Selected","wp-store-locator-widget-block"),checked:l,onChange:e=>w({...o,choiceSelected:e})}),(0,a.createElement)(s.CheckboxControl,{label:(0,p.__)("Hidden","wp-store-locator-widget-block"),checked:n,onChange:e=>w({...o,choiceHidden:e})}),(0,a.createElement)(s.Button,{variant:"primary",onClick:()=>{const e=c.filter(((e,o)=>o!==t));h({...m,choices:e})}},(0,p.__)("Delete choice","wp-store-locator-widget-block")))}function P(e){const{index:t,filter:o,propertyType:r,title:i,innerOperator:l,choices:n,filters:c,setAttributes:d}=e,g=e=>{const o=c.map(((o,r)=>r===t?e:o));d({filters:o})},[b,h]=(0,m.useState)(""),[w,y]=(0,m.useState)("");return(0,a.createElement)(s.PanelBody,{title:(0,p.__)("Filter: ","wp-store-locator-widget-block")+i+" {"+r+"}",initialOpen:!1},(0,a.createElement)(s.TextControl,{label:(0,p.__)("Property Type","wp-store-locator-widget-block"),value:r,onChange:e=>{(e=>!!e.trim()||((0,u.dispatch)("core/notices").createErrorNotice((0,p.__)("Property Type cannot be empty","wp-store-locator-widget-block"),{isDismissible:!0,type:"snackbar"}),!1))(e)&&g({...o,propertyType:e})}}),(0,a.createElement)(s.TextControl,{label:(0,p.__)("title","wp-store-locator-widget-block"),value:i,onChange:e=>{(e=>!!e.trim()||((0,u.dispatch)("core/notices").createErrorNotice((0,p.__)("Title cannot be empty","wp-store-locator-widget-block"),{isDismissible:!0,type:"snackbar"}),!1))(e)&&g({...o,title:e})}}),(0,a.createElement)(s.SelectControl,{label:(0,p.__)("Inner Operator","wp-store-locator-widget-block"),value:l,onChange:e=>g({...o,innerOperator:e})},(0,a.createElement)("option",{value:"and"},(0,p.__)("And","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"or"},(0,p.__)("Or","wp-store-locator-widget-block"))),(0,a.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,a.createElement)(s.TextControl,{label:(0,p.__)("Choice Key","wp-store-locator-widget-block"),value:b,onChange:e=>h(e)}),(0,a.createElement)(s.TextControl,{label:(0,p.__)("Choice Title","wp-store-locator-widget-block"),value:w,onChange:e=>y(e)}),(0,a.createElement)(s.Button,{variant:"primary",onClick:()=>{if(!b.trim())return void(0,u.dispatch)("core/notices").createErrorNotice((0,p.__)("Choice Key cannot be empty","wp-store-locator-widget-block"),{isDismissible:!0,type:"snackbar"});if(!w.trim())return void(0,u.dispatch)("core/notices").createErrorNotice((0,p.__)("Choice Title cannot be empty","wp-store-locator-widget-block"),{isDismissible:!0,type:"snackbar"});const e={choiceKey:b,choiceTitle:w,choiceSelected:!1},t=[...n,e];g({...o,choices:t}),h(""),y("")}},(0,p.__)("Add Choice","wp-store-locator-widget-block"))),n.map(((e,r)=>(0,a.createElement)(A,{key:r,choiceIndex:r,choice:e,choiceKey:e.choiceKey,choiceTitle:e.choiceTitle,choiceSelected:e.choiceSelected,choiceHidden:e.choiceHidden,choices:n,index:t,filter:o,filters:c,setAttributes:d}))),(0,a.createElement)(s.Button,{variant:"primary",onClick:()=>{const e=c.filter(((e,o)=>o!==t));d({filters:e})},style:{marginTop:20}},(0,p.__)("Delete filter","wp-store-locator-widget-block")))}function I(e){const{attributes:{filtersOpened:t,filtersCustomOrder:o,filters:r,filtersOuterOperator:i},setAttributes:l}=e,[n,c]=(0,m.useState)(""),[d,g]=(0,m.useState)("");return(0,a.createElement)(s.PanelBody,{title:(0,p.__)("Filters Settings","wp-store-locator-widget-block"),initialOpen:!1},(0,a.createElement)(s.CheckboxControl,{label:(0,p.__)("Filters Opened","wp-store-locator-widget-block"),checked:t,onChange:e=>l({filtersOpened:e})}),(0,a.createElement)(s.CheckboxControl,{label:(0,p.__)("Filters Custom Order","wp-store-locator-widget-block"),checked:o,onChange:e=>l({filtersCustomOrder:e})}),(0,a.createElement)(s.SelectControl,{label:(0,p.__)("Filters Outer Operator","wp-store-locator-widget-block"),value:i,onChange:e=>l({filtersOuterOperator:e})},(0,a.createElement)("option",{value:"and"},(0,p.__)("And","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"or"},(0,p.__)("Or","wp-store-locator-widget-block"))),(0,a.createElement)("div",{style:{marginBottom:20,padding:10,border:"1px solid lightgray",borderRadius:5}},(0,a.createElement)(s.SelectControl,{label:(0,p.__)("Property Type","wp-store-locator-widget-block"),onChange:e=>c(e)},(0,a.createElement)("option",{value:"type"},(0,p.__)("Type","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"tag"},(0,p.__)("Tag","wp-store-locator-widget-block")),(0,a.createElement)("option",{value:"custom"},(0,p.__)("Custom","wp-store-locator-widget-block"))),(0,a.createElement)(s.TextControl,{label:(0,p.__)("Title","wp-store-locator-widget-block"),value:d,onChange:e=>g(e)}),(0,a.createElement)(s.Button,{variant:"primary",onClick:()=>{if(!n.trim())return void(0,u.dispatch)("core/notices").createErrorNotice((0,p.__)("Property Type cannot be empty","wp-store-locator-widget-block"),{isDismissible:!0,type:"snackbar"});if(!d.trim())return void(0,u.dispatch)("core/notices").createErrorNotice((0,p.__)("Title cannot be empty","wp-store-locator-widget-block"),{isDismissible:!0,type:"snackbar"});const e={propertyType:n,title:d,innerOperator:"and",choices:[]},t=[...r,e];l({filters:t}),c(""),g("")}},(0,p.__)("Add Filter","wp-store-locator-widget-block"))),r.map(((e,t)=>(0,a.createElement)(P,{key:t,index:t,filter:e,propertyType:e.propertyType,title:e.title,innerOperator:e.innerOperator,choices:e.choices,filters:r,setAttributes:l}))))}function M(e){const{isAuthenticated:t}=e;return t?(0,a.createElement)(d.InspectorControls,null,(0,a.createElement)(v,{...e}),(0,a.createElement)(O,{...e}),(0,a.createElement)(S,{...e}),(0,a.createElement)(x,{...e}),(0,a.createElement)(I,{...e})):(0,a.createElement)(d.InspectorControls,null,(0,a.createElement)(s.PanelBody,null,(0,a.createElement)("p",null,(0,p.__)("You need to confirm your access to Woosmap before you can continue.","wp-store-locator-widget-block"))))}function L({setApiKey:e}){const[t,o]=(0,m.useState)(""),[r,i]=(0,m.useState)(!1),l=(0,u.useSelect)((e=>e("core").getEntityRecord("root","site")),[]);return(0,m.useEffect)((()=>{if(l){const{woosmap_settings:{woosmap_public_api_key:e}}=l;o(e)}}),[l]),(0,a.createElement)(a.Fragment,null,(0,a.createElement)(s.TextControl,{label:(0,p.__)("Please enter your Public API Key","wp-store-locator-widget-block"),readOnly:r,name:"woosmap_public_api_key",value:t,onChange:e=>o(e)}),(0,a.createElement)(s.Button,{isPrimary:!0,disabled:r,isBusy:r,onClick:()=>{i(!0),(0,u.dispatch)("core").saveEntityRecord("root","site",{woosmap_settings:{woosmap_public_api_key:t}}).then((({woosmap_settings:{woosmap_public_api_key:t}})=>{o(t),i(!1),e(t),window.dispatchEvent(new CustomEvent("woosmapSettingsSaved"))})).catch((e=>{(0,u.dispatch)("core/notices").createErrorNotice(e.message,{isDismissible:!0,type:"snackbar"}),i(!1)}))}},(0,p.__)("Confirm Woosmap Credentials","wp-store-locator-widget-block")))}(0,u.register)(C);const N={top:!1,right:!1,bottom:!0,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1};function B({onResizeStart:e,onResize:t,onResizeStop:o,...r}){const[i,l]=(0,m.useState)(!1);return(0,a.createElement)(s.ResizableBox,{style:{position:"absolute",top:0,left:0,right:0,bottom:0},className:"wp-store-locator-widget-block__resize-container "+(i?"is-resizing":""),enable:N,onResizeStart:(o,r,i)=>{e(i.clientHeight),t(i.clientHeight)},onResize:(e,o,r)=>{t(r.clientHeight),i||l(!0)},onResizeStop:(e,t,r)=>{o(r.clientHeight),l(!1)},minHeight:250,...r})}function R({blockProps:e,BlockIcon:t,initialConfig:o,onValidateConfig:r}){const{height:i,apiKey:l,...n}=o,[c,g]=(0,m.useState)(JSON.stringify(n,null,2)),b=(0,m.useCallback)((()=>{try{const e=function(e){return e.trim().replace(/\\\"/g,'\\\\"').replace(/([,{]\s*)([a-zA-Z0-9_]+):/g,'$1"$2":').replace(/,\s*}/g,"}").replace(/,\s*]/g,"]")}(c);g(e);const t=JSON.parse(e);r(t)}catch(e){const t=`Invalid Widget Conf format: ${e.message}`;(0,u.dispatch)("core/notices").createErrorNotice(t,{isDismissible:!0,type:"snackbar"})}}),[c,r]);return(0,a.createElement)("div",{...e},(0,a.createElement)(s.Placeholder,{label:(0,p.__)("Store Locator Widget Configuration","wp-store-locator-widget-block"),icon:t},(0,a.createElement)("pre",null,(0,a.createElement)(d.RichText,{value:c,onChange:e=>g(e),placeholder:(0,p.__)("Write json confâ€¦"),"aria-label":(0,p.__)("Conf"),preserveWhiteSpace:!0,allowedFormats:[],withoutInteractiveFormatting:!0,__unstablePastePlainText:!0})),(0,a.createElement)(s.Button,{isPrimary:!0,onClick:b,style:{marginTop:"10px"}},(0,p.__)("Validate Configuration","wp-store-locator-widget-block"))))}const W=(0,m.memo)((e=>{const{storeLocatorWidget:t,isAuthenticated:o,clientId:r,setAttributes:i,setStoreLocatorWidget:l,webAppLib:n,apiKey:c}=e,s=!!t,p=(0,g.useRefEffect)((e=>{if(n)return o&&!s&&l(new k(e,r,i)),()=>{s&&(t.remove(),l(null))}}),[n,c,o,t,r,i]);return(0,a.createElement)("div",{id:"storeLocatorWidgetEdit",ref:p})}));(0,l.registerBlockType)(c,{attributes:{...c.attributes},icon:n,edit:function(e){const{attributes:t,setAttributes:o,clientId:r,isSelected:i}=e,{height:l,apiKey:c}=t,[b,h]=(0,m.useState)(null),[w,y]=(0,m.useState)(null),[k,_]=(0,m.useState)(c),f=!!b,[E,v]=(0,m.useState)(!0),[S,T]=(0,m.useState)(!1),x=(0,u.useSelect)((e=>e(C).isAuthenticated())),{updateAuthenticationStatus:O}=(0,u.useDispatch)(C),{toggleSelection:A}=(0,u.useDispatch)(d.store),P=(0,g.useDebounce)((e=>{b.update(e)}),500),I=(0,g.useRefEffect)((e=>{const t=!!e.ownerDocument.defaultView.WebApp;if(!t)return void y(null);y(t);const o=()=>{(({status:e})=>{"Initialized"===e&&(v(!1),O(!0))})({status:"Initialized"})};return t&&(v(!1),k&&o()),window.addEventListener("woosmapSettingsSaved",o),()=>{window.removeEventListener("woosmapSettingsSaved",o),y(null)}}));(0,m.useEffect)((()=>{x&&v(!1)}),[x]),(0,m.useEffect)((()=>{x&&f&&P(t)}),[t,x,b,f]);const N=(0,d.useBlockProps)({ref:I});return E?(0,a.createElement)("div",{...N},(0,a.createElement)(s.Placeholder,{style:{height:`${l}px`},label:(0,p.__)("Block for Woosmap Store Locator Widget","wp-store-locator-widget-block"),icon:n},(0,a.createElement)(s.Spinner,null))):x?S?(0,a.createElement)(R,{blockProps:N,BlockIcon:n,initialConfig:t,onValidateConfig:e=>{o(e),T(!1)}}):(0,a.createElement)(a.Fragment,null,(0,a.createElement)(d.BlockControls,null,(0,a.createElement)(s.ToolbarGroup,null,(0,a.createElement)(s.ToolbarButton,{icon:"admin-generic",label:(0,p.__)("Show Configuration","wp-store-locator-widget-block"),onClick:()=>T(!S)}))),(0,a.createElement)(M,{...e,isAuthenticated:x,storeLocatorWidget:b,webAppLib:w}),(0,a.createElement)("div",{...N},(0,a.createElement)(B,{onResizeStart:()=>{A(!1)},onResize:e=>{b.update({height:e},!1)},onResizeStop:e=>{o({height:e}),A(!0)},showHandle:i,size:{height:l}}),(0,a.createElement)(W,{clientId:r,setAttributes:o,isAuthenticated:x,webAppLib:w,storeLocatorWidget:b,setStoreLocatorWidget:h,apiKey:k}))):(0,a.createElement)(a.Fragment,null,(0,a.createElement)(M,{...e,isAuthenticated:x,storeLocatorWidget:b,webAppLib:w}),(0,a.createElement)("div",{...N},(0,a.createElement)(s.Placeholder,{style:{minHeight:`${l}px`},label:(0,p.__)("Authorize Woosmap Access","wp-store-locator-widget-block"),icon:n,isColumnLayout:!0},(0,a.createElement)("div",{style:{marginBottom:"1em"}},(0,p.__)("To embed a Woosmap Store Locator Widget in your website, you need to provide your Public API Key. Follow the instructions in the documentation to obtain this key: ","wp-store-locator-widget-block"),(0,a.createElement)("a",{href:"https://developers.woosmap.com/support/api-keys/#registering-a-woosmap-public-api-key",target:"_blank",rel:"noopener noreferrer"},(0,p.__)("Guide to register a Woosmap Public API Key.","wp-store-locator-widget-block"))),(0,a.createElement)(L,{setApiKey:e=>{_(e),o({apiKey:e})}}))))},save:function(e){const{attributes:{height:t,apiKey:o,theme:r,internationalization:i,woosmapView:l,tileColor:n,tileSize:c,breakPoint:s,defaultStyle:p,customMarkers:m,filtersOpened:u,filtersCustomOrder:g,filters:b,filtersOuterOperator:h}}=e,w=d.useBlockProps.save({style:{height:`${t}px`},id:"storeLocatorWidget"});return(0,a.createElement)("div",{...w,"data-api-key":o,"data-theme":JSON.stringify(r),"data-internationalization":JSON.stringify(i),"data-woosmap-view":JSON.stringify(l),"data-tile-color":n,"data-tile-size":c,"data-break-point":s,"data-default-style":JSON.stringify(p),"data-custom-markers":JSON.stringify(m),"data-filters-opened":u,"data-filters-custom-order":g,"data-filters":JSON.stringify(b),"data-filters-outer-operator":h})}})}},o={};function r(e){var i=o[e];if(void 0!==i)return i.exports;var l=o[e]={exports:{}};return t[e](l,l.exports,r),l.exports}r.m=t,e=[],r.O=(t,o,i,l)=>{if(!o){var a=1/0;for(p=0;p<e.length;p++){for(var[o,i,l]=e[p],n=!0,c=0;c<o.length;c++)(!1&l||a>=l)&&Object.keys(r.O).every((e=>r.O[e](o[c])))?o.splice(c--,1):(n=!1,l<a&&(a=l));if(n){e.splice(p--,1);var s=i();void 0!==s&&(t=s)}}return t}l=l||0;for(var p=e.length;p>0&&e[p-1][2]>l;p--)e[p]=e[p-1];e[p]=[o,i,l]},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={57:0,350:0};r.O.j=t=>0===e[t];var t=(t,o)=>{var i,l,[a,n,c]=o,s=0;if(a.some((t=>0!==e[t]))){for(i in n)r.o(n,i)&&(r.m[i]=n[i]);if(c)var p=c(r)}for(t&&t(o);s<a.length;s++)l=a[s],r.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return r.O(p)},o=globalThis.webpackChunkwp_store_locator_widget_block=globalThis.webpackChunkwp_store_locator_widget_block||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))})();var i=r.O(void 0,[350],(()=>r(415)));i=r.O(i)})();