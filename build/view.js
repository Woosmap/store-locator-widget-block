(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.domReady;var o=e.n(t);const r=window.wp.data,i={primary_color:"#000"},s={max_responses:5,max_distance:5e4},a={lang:"en",period:"fr",unitSystem:0},n={initialCenter:{lat:50,lng:0},initialZoom:13,tileStyle:{color:"#000",size:11,minSize:5,typeRules:[]},breakPoint:10,style:{rules:[],default:{icon:{url:"https://images.woosmap.com/marker-default.svg"},selectedIcon:{url:"https://images.woosmap.com/marker-selected.svg"},numberedIcon:{url:"https://images.woosmap.com/marker-default.svg"}}}};function c(e,t){return Object.keys(t).forEach((o=>{t[o]&&"object"==typeof t[o]?(e[o]||(e[o]={}),c(e[o],t[o])):e[o]=t[o]})),e}function l(e,t={}){try{return c(t,JSON.parse(e))}catch(e){return(0,r.dispatch)("core/notices").createErrorNotice(`Error parsing conf: ${e.message}`,{isDismissible:!0,type:"snackbar"}),t}}function p(e=[]){return e.map((({storeType:e="store_type",customTyleColor:t="#000",customDefaultMarkerUrl:o,customSelectedMarkerUrl:r,customNumberedMarkerUrl:i})=>({type:e,color:t,icon:{url:o||"https://images.woosmap.com/marker-default.svg"},selectedIcon:{url:r||"https://images.woosmap.com/marker-selected.svg"},numberedIcon:{url:i||"https://images.woosmap.com/marker-default.svg"}})))}function m(e=[]){return e.map((({propertyType:e="propertyType",title:t,choices:o=[],innerOperator:r="and"})=>({propertyType:e,title:{en:t||"title"},choices:o.map((({choiceKey:e="choiceKey",choiceTitle:t="choiceTitle",choiceSelected:o=!1,choiceHidden:r=!1})=>({key:e,en:t,selected:o,hidden:r}))),innerOperator:r})))}class d{constructor(e){this.element=e,this.storeLocatorConfig={},this.webAppLib=e.ownerDocument.defaultView.WebApp,this.webAppLib&&this.element.dataset.apiKey&&this.init()}init(){this.createStoreLocatorWidget()}createStoreLocatorWidget(){const e=function(e){const{customMarkers:t="[]",filters:o="[]",theme:r="{}",datasource:c="{}",internationalization:d="{}",woosmapView:u="{}",apiKey:h,filtersOpened:y="false",filtersCustomOrder:f="false",filtersOuterOperator:g="or"}=e,w=l(u,n);return{theme:l(r,i),datasource:l(c,s),internationalization:l(d,a),maps:{apiKey:h,provider:"woosmap"},woosmapview:{initialCenter:w.initialCenter,initialZoom:w.initialZoom,tileStyle:{color:w.tileStyle.color,size:Number(w.tileStyle.size),minSize:Number(w.tileStyle.minSize),typeRules:p(l(t,[]))},breakPoint:Number(w.breakPoint),style:{rules:p(l(t,[])),default:w.style.default}},filters:{opened:"true"===y,customOrder:"true"===f,filters:m(l(o,[])),outerOperator:g}}}(this.element.dataset);this.storeLocatorConfig=function(e){if(!e.maps.apiKey||"string"!=typeof e.maps.apiKey||!e.maps.apiKey.trim())throw new Error("StoreLocator configuration error: apiKey is required and must be a non-empty string.");return e}(e),this.element.innerHTML="";const t=document.createElement("div");t.style="width:100%; height:100%",t.id="store-locator-widget-id",this.element.appendChild(t),this.storeLocatorWidget&&(this.storeLocatorWidget.isMobile=!1,this.storeLocatorWidget.confHandler.setInitConf(this.storeLocatorConfig)),this.storeLocatorWidget=new this.webAppLib(t.id,this.storeLocatorConfig.maps.apiKey),this.storeLocatorWidget.isMobile=!1,this.storeLocatorWidget.confHandler.setInitConf(this.storeLocatorConfig)}}o()((async()=>{const e=document.querySelector(".wp-block-woosmap-store-locator-widget-block");e&&new d(e)}))})();